# Custom Location logic for the Swindon sim

# Entry point rules
entry_point_rules:
  EUPBAD:
    list_to_delete_if_before: ['WSTLGHJ']

  EDNMAIN:
    # The code will set the Marshfield entry point ot the mains by default. This logic can be used to set the entry to the reliefs if TT data suggests a train uses them.
    if_later_location_matching:
      # Conditons the train locations must match
      conditions:
        # The train must have newport as a location and the platform is 'URL' (up through line)
        - { 'location':'GORASTR', 'line': 'RL' }
        - OR
        - { 'location':'GORASTR', 'path': 'RL' }
        - OR
        - { 'location':'GORASTR', 'line': 'RL', 'plat': '3' }
        - OR
        - { 'location':'GORASTR', 'plat': '3' }
      # What will change if conditions are met.
      then:
        # Set entry to Marshfield Reliefs
        - entry_point: 'EDNRLF'
        # Remove 1st instance Marshfield location from train location list (needed for valid TT data)
        - remove_1st_of: [ 'Reading' ]


# Location rules
location_rules:
  'dummy location':
    # Rule not implemented yet.
    - if_x_y_z_then_delete_y:
        x: 'first'
        y: 'second'
        z: 'third'

  GORASTR:
    - if_particular_present:
        conditions:
          - { 'location':'GORASTR', 'line': 'RL' }
        then:
          - remove_props_from_location:  { 'location': 'GORASTR', props: ['line'] }


  'Didcot East Jn':
    - if_x_y_concurrent:
        x_conditions:
          - { 'location': 'Didcot East Jn', 'line': 'URL' }
        y_conditions:
          - { 'location': 'Didcot Parkway', 'plat': '4' }
        then:
          - modify_location:  { 'location': 'Didcot Parkway', 'path': 'URL' }

    - if_x_y_concurrent:
        x_conditions:
          - { 'location': 'Didcot East Jn', 'line': 'URL' }
        y_conditions:
          - { 'location': 'Didcot Parkway', 'plat': '5' }
        then:
          - modify_location: { 'location': 'Didcot Parkway', 'path': 'URL' }

  'Thingley East Junction':
    - if_x_y_concurrent:
        x_conditions:
          - { 'location': 'Thingley East Junction', 'line': '!DM' }
        y_conditions:
          - { 'location': 'Chippenham' }
        then:
          - modify_location: { old_location: 'Thingley East Junction', new_location: 'THNGLYJ' }

    - if_x_y_concurrent:
        x_conditions:
          - { 'location': 'THNGLYJ' }
        y_conditions:
          - { 'location': 'Thingley East Junction' }
        then:
          - remove_1st_of: [ 'Thingley East Junction' ]

  HGHWTHJ:
    - remove_location:
        conditions:
          - { 'location':'HGHWTHJ', '!line': 'no line', '!path': 'no path' }
          - OR
          - { 'location':'HGHWTHJ', 'line': 'ML' }
          - OR
          - { 'location':'HGHWTHJ', 'path': 'ML' }

  BOURTON:
    - remove_location:
        conditions:
          - { 'location': 'BOURTON', '!line': 'no line', '!path': 'no path' }
          - OR
          - { 'location': 'BOURTON', 'line': 'ML' }
          - OR
          - { 'location': 'BOURTON', 'path': 'ML' }

  Steventon:
    - remove_location:
        conditions:
          - { 'location': 'Steventon', '!line': 'no line', '!path': 'no path' }
          - OR
          - { 'location': 'Steventon', 'line': 'ML' }
          - OR
          - { 'location': 'Steventon', 'path': 'ML' }

  Milton Junction:
    - remove_location:
        conditions:
          - { 'location': 'Milton Junction', '!line': 'no line', '!path': 'no path' }
          - OR
          - { 'location': 'Milton Junction', 'line': 'ML' }
          - OR
          - { 'location': 'Milton Junction', 'path': 'ML' }

  Foxhall Jn [XJF]:
    - remove_location:
        conditions:
          - { 'location': 'Foxhall Jn [XJF]', '!line': 'no line', '!path': 'no path' }
          - OR
          - { 'location': 'Foxhall Jn [XJF]', 'line': 'ML' }
          - OR
          - { 'location': 'Foxhall Jn [XJF]', 'path': 'ML' }

  Didcot West End:
    - remove_location:
        conditions:
          - { 'location': 'Didcot West End' }

  Moreton Cutting:
    - remove_location:
        conditions:
          - { 'location': 'Moreton Cutting', '!line': 'no line', '!path': 'no path' }

  Rushey Platt:
    - remove_location:
        conditions:
          - { 'location': 'Rushey Platt', '!line': 'no line', '!path': 'no path' }





#    - if_x_y_concurrent:
#        x_conditions:
#          - { 'location': 'Severn Tunnel Junction' }
#        y_conditions:
#          - { 'location': 'SEVTUGL' }
#        then:
#          - modify_location: { 'location': 'Severn Tunnel Junction', 'plat': '3' }